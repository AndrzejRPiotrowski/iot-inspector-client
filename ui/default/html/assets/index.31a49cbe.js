import{G as v,j as a,a as e,r as d,R as N,H as b,c as _,b as w,d as k,g,u as x,F as u}from"./main.3d678737.js";import{d as y}from"./utils.7514bafb.js";import{u as S,_ as A}from"./array.3b151b1e.js";function p(t){return v({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7 20h2V8h3L8 4 4 8h3zm13-4h-3V4h-2v12h-3l4 4z"}}]})(t)}const C=({device:t})=>a("div",{className:"device-item status-empty",children:[a("div",{className:"device-info",children:[e("img",{src:"https://via.placeholder.com/150",alt:t?t.auto_name:"Unknown Device",className:"hidden w-auto h-12 lg:block md:h-16"}),a("div",{className:"px-4",children:[e("h3",{children:t?t.auto_name:"Unknown Device"}),a("p",{className:"text-xs",children:[t&&t.ip,e("br",{}),t&&t.mac]})]})]}),e("div",{className:"device-tags",children:e("div",{className:"tag",children:"tag"})}),a("div",{className:"device-details",children:[t&&e("div",{className:"flex items-center justify-center px-4 text-sm border-r border-gray-300 w-fit",children:y(t.outbound_byte_count)}),e("div",{className:"flex items-center justify-center px-4 text-sm w-fit",children:e("a",{href:`/device-activity?deviceid=${t.device_id}`,className:"",children:"Details"})})]})]}),D=()=>{const{devicesData:t,devicesDataLoading:i,sortDevicesData:r}=S(),[s,n]=d.exports.useState(""),[c,h]=d.exports.useState("ASC"),[l,f]=d.exports.useState(!1);return a("section",{className:"bg-gray-50 flex-flex-col-gap-4",id:"inspecting-devices",children:[a("div",{className:"flex items-center w-full gap-4 md:gap-5",children:[a("div",{className:"",children:[e("h2",{className:"h1",children:"Inspecting Devices"}),e("p",{className:"py-2",children:"Naming & tagging helps with our research"})]}),e("div",{className:"w-8 h-8 md:w-10 md:h-10 animate-spin-slow",children:e(N,{})})]}),a("div",{className:"grid grid-cols-4 gap-4 py-4 md:flex md:items-center",children:[a("form",{className:"flex flex-1 order-last col-span-4 md:order-first",children:[e("input",{type:"text",name:"search",id:"searchDevices",value:s,onChange:o=>n(o.target.value),className:"w-full px-4 py-2 text-gray-600 bg-white border border-gray-400 rounded-md",placeholder:"Search devices by name or tag"}),a("label",{htmlFor:"searchDevices",className:"sr-only",children:[e(b,{}),"Search devices by name or tag"]})]}),a("button",{className:"flex items-center justify-center gap-1 p-2 text-sm",children:["Name",e(p,{className:"w-4 h-4 text-gray-400"})]}),a("button",{className:"flex items-center justify-center gap-1 p-2 text-sm",onClick:()=>{h(c==="ASC"?"DESC":"ASC"),r("outbound_byte_count",c)},children:["Traffic",e(p,{className:"w-4 h-4 text-gray-400"})]}),e("div",{className:"flex items-center justify-center gap-3 px-2",children:e(_,{checked:l,onChange:f,children:a("span",{className:"flex",children:[e(w,{className:`${l?"text-white rounded-lg bg-secondary":"text-dark"} w-10 h-10 md:w-8 md:h-8 p-1 `}),e(k,{className:`${l?"text-dark":"text-white rounded-lg bg-secondary"} w-10 h-10 md:w-8 md:h-8 p-1 `})]})})})]}),i?e("div",{className:"skeleton h-[600px]"}):e("ul",{className:l?"card-grid":"min-h-[200px]",children:t==null?void 0:t.filter(o=>{if(!s||o.auto_name.toLowerCase().includes(s.toLowerCase()))return!0}).map(o=>e("li",{className:`${l?"card-view":"list-view"} py-2`,children:e(C,{device:o})},o.device_id))})]})},m=({children:t,bytes:i})=>a("div",{className:"flex-1 px-4 py-3 bg-white border border-gray-200 rounded-lg shadow-sm",children:[e("div",{className:"block",children:e("span",{className:"h1",children:y(i)})}),t]}),I=g`
  query Query($currentTime: Int!) {
    chartActivity(current_time: $currentTime) {
      xAxis
      yAxis {
        name
        data
      }
    }
  }
`,T=t=>{var n,c,h,l;t!=null&&t.pullInterval,(c=(n=t==null?void 0:t.filters)==null?void 0:n.sort)!=null&&c.by,(l=(h=t==null?void 0:t.filters)==null?void 0:h.sort)!=null&&l.ascending;const i={deviceId:(t==null?void 0:t.deviceId)||null,currentTime:Math.round(new Date().getTime()/1e3)},{data:r,loading:s}=x(I,{variables:i});return{networkDownloadActivity:r,networkDownloadActivityLoading:s}},U=({deviceId:t})=>{const{networkDownloadActivity:i,networkDownloadActivityLoading:r}=T(),s=d.exports.useMemo(()=>{var c;return{chart:{id:"bar",stacked:!0},xaxis:{categories:((c=i==null?void 0:i.chartActivity)==null?void 0:c.xAxis)||[],type:"string"},options:{plotOptions:{bar:{borderRadius:"10px"}}}}},[i]),n=d.exports.useMemo(()=>{var c;return((c=i==null?void 0:i.chartActivity)==null?void 0:c.yAxis)||[]},[i]);return e("div",{className:"network-bar-chart",children:e("div",{className:"row",children:e("div",{className:"mixed-chart",children:e(A,{options:s,series:n,type:"bar",width:"100%",height:"300"})})})})},H=g`
  query Query {
    devices {
      auto_name
      ip
      outbound_byte_count
    }
  }
`,L=()=>{const[t,i]=d.exports.useState([]),{data:r,loading:s}=x(H);return d.exports.useEffect(()=>{if(r!=null&&r.devices){const n=r==null?void 0:r.devices.slice().sort((c,h)=>h.outbound_byte_count-c.outbound_byte_count);i(n)}},[r==null?void 0:r.devices]),{highUseageData:t,highUseageDataLoading:s}},V=g`
  query Query {
    networkActivity {
      weak_encryption
      unencrypted_http_traffic
      ads_and_trackers
    }
  }
`,E=()=>{const[t,i]=d.exports.useState([]),{data:r,loading:s}=x(V,{});return d.exports.useEffect(()=>{r!=null&&r.networkActivity&&i(r.networkActivity)},[r==null?void 0:r.networkActivity]),{networkActivityData:t,networkActivityDataLoading:s}},j=()=>{const{highUseageData:t,highUseageDataLoading:i}=L(),{networkActivityDataLoading:r,networkActivityData:s}=E();return a(u,{children:[i?e(u,{children:"loading..."}):a("section",{className:"flex flex-col gap-4",children:[e("h1",{children:"Network Activity"}),e(U,{})]}),e("section",{className:"flex flex-col gap-4 bg-gray-50",children:a("div",{className:"grid gap-6 py-8 lg:grid-cols-2 md:py-4",children:[a("div",{children:[a("p",{children:["High data usage devices in the past 24 hours",e("br",{}),e("a",{href:"#inspecting-devices",children:"View all devices"})]}),a("div",{className:"grid grid-cols-2 gap-2 py-4",children:[i&&e(u,{children:"loading..."}),t&&t.slice(0,3).map((n,c)=>a(m,{bytes:n.outbound_byte_count,children:[e("span",{className:"text-xs",children:n.auto_name}),e("br",{}),e("span",{className:"text-xs",children:n.ip})]},c))]})]}),r?e("div",{className:"skeleton h-[114px]"}):a("div",{children:[a("p",{children:["Monitored devices sent/recieved",e("br",{}),e("strong",{children:y((s==null?void 0:s.ads_and_trackers)+(s==null?void 0:s.unencrypted_http_traffic)+(s==null?void 0:s.weak_encryption))})]}),a("div",{className:"grid grid-cols-2 gap-2 py-4",children:[e(m,{bytes:s==null?void 0:s.ads_and_trackers,children:e("span",{className:"text-xs",children:"Ads & Trackers"})}),e(m,{bytes:s==null?void 0:s.unencrypted_http_traffic,children:e("span",{className:"text-xs",children:"Unencrypted HTTP Traffic"})}),e(m,{bytes:s==null?void 0:s.weak_encryption,children:e("span",{className:"text-xs",children:"Weak Encryption"})})]})]})]})})]})},G=()=>a(u,{children:[e(j,{}),e(D,{})]});export{G as default};
