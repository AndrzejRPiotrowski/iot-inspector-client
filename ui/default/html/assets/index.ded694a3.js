import{G as w,P as A,j as r,a as e,u as N,r as o,R as k,H as D,b as S,c as I,d as C,F as g,g as x,e as y}from"./main.3d9e6d7b.js";import{d as v}from"./utils.7514bafb.js";import{_ as U}from"./array.5b6def4f.js";import{E as T}from"./EndpointDrawer.44fe9fd8.js";function f(s){return w({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7 20h2V8h3L8 4 4 8h3zm13-4h-3V4h-2v12h-3l4 4z"}}]})(s)}const _=({device:s})=>{var a;const i=s.device_info.tag_list;return r("div",{className:"device-item status-empty",children:[r("div",{className:"device-info",children:[e("img",{src:"https://via.placeholder.com/150",alt:s?s.auto_name:"Unknown Device",className:"hidden w-auto h-12 lg:block md:h-16"}),r("div",{className:"px-4",children:[e("h3",{children:((a=s==null?void 0:s.device_info)==null?void 0:a.device_name)||(s==null?void 0:s.auto_name)||"Unknown Device"}),r("p",{className:"text-xs",children:[s&&s.ip,e("br",{}),s&&s.mac]})]})]}),e("div",{className:"device-tags",children:JSON.parse(i).map(t=>e("div",{className:"tag",children:t},t))}),r("div",{className:"device-details",children:[s&&e("div",{className:"flex items-center justify-center px-4 text-sm border-r border-gray-300 w-fit",children:v(s.outbound_byte_count)}),e("div",{className:"flex items-center justify-center px-4 text-sm w-fit",children:e("a",{href:`/device-activity?deviceid=${s.device_id}`,className:"",children:"Details"})})]})]})};_.propTypes={tagList:A.array};const E=()=>{const{devicesData:s,devicesDataLoading:i,sortDevicesData:a}=N(),[t,n]=o.exports.useState(""),[h,c]=o.exports.useState("ASC"),[m,u]=o.exports.useState(!1);return r("section",{className:"bg-gray-50 flex-flex-col-gap-4",id:"inspecting-devices",children:[r("div",{className:"flex items-center w-full gap-4 md:gap-5",children:[r("div",{className:"",children:[e("h2",{className:"h1",children:"Inspecting Devices"}),e("p",{className:"py-2",children:"Naming & tagging helps with our research"})]}),e("div",{className:"w-8 h-8 md:w-10 md:h-10 animate-spin-slow",children:e(k,{})})]}),r("div",{className:"grid grid-cols-4 gap-4 py-4 md:flex md:items-center",children:[r("form",{className:"flex flex-1 order-last col-span-4 md:order-first",children:[e("input",{type:"text",name:"search",id:"searchDevices",value:t,onChange:l=>n(l.target.value),className:"w-full px-4 py-2 text-gray-600 bg-white border border-gray-400 rounded-md",placeholder:"Search devices by name or tag"}),r("label",{htmlFor:"searchDevices",className:"sr-only",children:[e(D,{}),"Search devices by name or tag"]})]}),r("button",{className:"flex items-center justify-center gap-1 p-2 text-sm",children:["Name",e(f,{className:"w-4 h-4 text-gray-400"})]}),r("button",{className:"flex items-center justify-center gap-1 p-2 text-sm",onClick:()=>{c(h==="ASC"?"DESC":"ASC"),a("outbound_byte_count",h)},children:["Traffic",e(f,{className:"w-4 h-4 text-gray-400"})]}),e("div",{className:"flex items-center justify-center gap-3 px-2",children:e(S,{checked:m,onChange:u,children:r("span",{className:"flex",children:[e(I,{className:`${m?"text-white rounded-lg bg-secondary":"text-dark"} w-10 h-10 md:w-8 md:h-8 p-1 `}),e(C,{className:`${m?"text-dark":"text-white rounded-lg bg-secondary"} w-10 h-10 md:w-8 md:h-8 p-1 `})]})})})]}),i?e("div",{className:"skeleton h-[600px]"}):e("ul",{className:m?"card-grid":"min-h-[200px]",children:s==null?void 0:s.filter(l=>{if(!t||l.auto_name.toLowerCase().includes(t.toLowerCase()))return!0}).map(l=>e(g,{children:l.device_info.is_inspected==1&&e("li",{className:`${m?"card-view":"list-view"} py-2`,children:e(_,{device:l})},l.device_id)}))})]})},p=({children:s,bytes:i})=>r("div",{className:"flex-1 px-4 py-3 bg-white border border-gray-200 rounded-lg shadow-sm",children:[e("div",{className:"block",children:e("span",{className:"h1",children:v(i)})}),s]}),L=x`
  query Query {
    chartActivity {
      xAxis
      yAxis {
        name
        data
      }
    }
  }
`,V=s=>{const i={pullInterval:(s==null?void 0:s.pullInterval)||6e5},a={deviceId:(s==null?void 0:s.deviceId)||null},{data:t,loading:n}=y(L,{variables:a,pollInterval:i.pullInterval});return{networkDownloadActivity:t,networkDownloadActivityLoading:n}},H=({deviceId:s})=>{const{networkDownloadActivity:i,networkDownloadActivityLoading:a}=V({pullInterval:6e4}),{devicesData:t}=N(),n=o.exports.useMemo(()=>{var c;return{chart:{id:"bar",stacked:!0},xaxis:{categories:((c=i==null?void 0:i.chartActivity)==null?void 0:c.xAxis)||[],type:"string"},options:{plotOptions:{bar:{borderRadius:"10px"}}}}},[i]),h=o.exports.useMemo(()=>{var m;if(!t||!i)return[];let c=i;return c=c.chartActivity.yAxis.map(u=>{const l=t.find(b=>b.device_id===u.name);return{...u,name:l.device_info.device_name||l.auto_name||`Unknown Device - ${d.device_id}`}}),c={...i,chartActivity:{yAxis:c}},((m=c==null?void 0:c.chartActivity)==null?void 0:m.yAxis.slice(0,3))||[]},[i,t]);return e("div",{className:"network-bar-chart",children:e("div",{className:"row",children:e("div",{className:"mixed-chart",children:e(U,{options:n,series:h,type:"bar",width:"100%",height:"300"})})})})},j=x`
  query Query {
    devices {
      auto_name
      ip
      outbound_byte_count
    }
  }
`,R=()=>{const[s,i]=o.exports.useState([]),{data:a,loading:t}=y(j,{pollInterval:2e4});return o.exports.useEffect(()=>{if(a!=null&&a.devices){const n=a==null?void 0:a.devices.slice().sort((h,c)=>c.outbound_byte_count-h.outbound_byte_count);i(n)}},[a==null?void 0:a.devices]),{highUseageData:s,highUseageDataLoading:t}},Q=x`
  query Query {
    networkActivity {
      weak_encryption
      unencrypted_http_traffic
      ads_and_trackers
    }
  }
`,G=()=>{const[s,i]=o.exports.useState([]),{data:a,loading:t}=y(Q,{});return o.exports.useEffect(()=>{a!=null&&a.networkActivity&&i(a.networkActivity)},[a==null?void 0:a.networkActivity]),{networkActivityData:s,networkActivityDataLoading:t}},Y=()=>{const{highUseageData:s,highUseageDataLoading:i}=R(),{networkActivityDataLoading:a,networkActivityData:t}=G();return r(g,{children:[i?e("div",{className:"h-full skeleton"}):r("section",{className:"flex flex-col gap-4",children:[e("h1",{children:"Network Activity"}),r("p",{children:["High data usage devices in the past 24 hours",e("br",{}),e("a",{href:"#inspecting-devices",children:"View all devices"})]}),e(H,{}),r("div",{className:"grid gap-2 py-4 md:grid-cols-2 lg:grid-cols-3",children:[i&&e(g,{children:e("div",{className:"skeleton h-[114px]"})}),s&&s.slice(0,3).map((n,h)=>r(p,{bytes:n.outbound_byte_count,children:[e("span",{className:"text-xs",children:n.auto_name}),e("br",{}),e("span",{className:"text-xs",children:n.ip})]},h))]}),e("hr",{}),e("div",{className:"grid gap-6 py-8 md:py-4",children:a?e("div",{className:"skeleton h-[114px]"}):r("div",{children:[r("p",{children:["All monitored devices sent/recieved \xA0",e("strong",{children:v((t==null?void 0:t.ads_and_trackers)+(t==null?void 0:t.unencrypted_http_traffic)+(t==null?void 0:t.weak_encryption))}),"\xA0 of data"]}),r("div",{className:"grid gap-2 py-4 md:grid-cols-2 lg:grid-cols-3",children:[e(p,{bytes:t==null?void 0:t.ads_and_trackers,children:e("span",{className:"text-xs",children:"Ads & Trackers"})}),e(p,{bytes:t==null?void 0:t.unencrypted_http_traffic,children:e("span",{className:"text-xs",children:"Unencrypted HTTP Traffic"})}),e(p,{bytes:t==null?void 0:t.weak_encryption,children:e("span",{className:"text-xs",children:"Weak Encryption"})})]})]})})]}),e("section",{className:"flex flex-col gap-4 bg-gray-50"})]})},F=()=>r(g,{children:[e(Y,{}),e(E,{}),e(T,{})]});export{F as default};
